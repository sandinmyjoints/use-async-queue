var n,t=require("react"),e=(n=require("next-tick"))&&"object"==typeof n&&"default"in n?n.default:n;module.exports=function(n){var u=n.done,r=n.drain,i=n.inflight,c=n.concurrency;(c=c||Infinity)<1&&(c=Infinity);var s=t.useState({numPending:0,numInFlight:0,numDone:0}),f=s[0],a=s[1],o=t.useRef(!0),g=t.useRef([]),l=t.useRef([]);return t.useEffect(function(){if(f.numDone>0&&r&&0===g.current.length&&0===l.current.length&&!o.current)return o.current=!0,e(r);for(var n=function(){o.current=!1;var n=l.current.shift();if(n){g.current.push(n),a(function(n){return Object.assign({},n,{numPending:n.numPending-1,numInFlight:n.numInFlight+1})}),i&&i(Object.assign({},n,{stats:f}));var t=n.task();t.then(function(){g.current.pop(),a(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),u&&u(Object.assign({},n,{result:t,stats:f}))}).catch(function(){g.current.pop(),a(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),u&&u(Object.assign({},n,{result:t,stats:f}))})}};g.current.length<c&&l.current.length>0;)n()},[c,u,r,i,f]),{add:t.useCallback(function(n){l.current.find(function(t){return t.id===n.id})||g.current.find(function(t){return t.id===n.id})||(l.current.push(n),a(function(n){return Object.assign({},n,{numPending:n.numPending+1})}))},[]),stats:f}};
//# sourceMappingURL=use-async-queue.js.map
