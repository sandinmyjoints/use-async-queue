import{useState as n,useRef as t,useCallback as r,useEffect as u}from"react";import e from"next-tick";export default function(i){var c=i.done,s=i.drain,o=i.inflight,g=i.concurrency;(g=g||Infinity)<1&&(g=Infinity);var a=n({numPending:0,numInFlight:0,numDone:0}),f=a[0],m=a[1],h=t(!0),l=t([]),d=t([]);return u(function(){if(f.numDone>0&&s&&0===l.current.length&&0===d.current.length&&!h.current)return h.current=!0,e(s);for(var n=function(){h.current=!1;var n=d.current.shift();if(n){l.current.push(n),m(function(n){return Object.assign({},n,{numPending:n.numPending-1,numInFlight:n.numInFlight+1})}),o&&o(Object.assign({},n,{stats:f}));var t=n.task();t.then(function(){l.current.pop(),m(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),c&&c(Object.assign({},n,{result:t,stats:f}))}).catch(function(){l.current.pop(),m(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),c&&c(Object.assign({},n,{result:t,stats:f}))})}};l.current.length<g&&d.current.length>0;)n()},[g,c,s,o,f]),{add:r(function(n){d.current.find(function(t){return t.id===n.id})||(d.current.push(n),m(function(n){return Object.assign({},n,{numPending:n.numPending+1})}))},[]),stats:f}}
//# sourceMappingURL=use-async-queue.module.js.map
