import{useState as n,useRef as t,useCallback as r,useEffect as u}from"react";import e from"next-tick";export default function(i){var c=i.done,o=i.drain,s=i.inflight,f=i.concurrency;(f=f||Infinity)<1&&(f=Infinity);var g=n({numPending:0,numInFlight:0,numDone:0}),a=g[0],m=g[1],h=t(!0),d=t([]),l=t([]);return u(function(){if(a.numDone>0&&o&&0===d.current.length&&0===l.current.length&&!h.current)return h.current=!0,e(o);for(var n=function(){h.current=!1;var n=l.current.shift();if(n){d.current.push(n),m(function(n){return Object.assign({},n,{numPending:n.numPending-1,numInFlight:n.numInFlight+1})}),s&&s(Object.assign({},n,{stats:a}));var t=n.task();t.then(function(){d.current.pop(),m(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),c&&c(Object.assign({},n,{result:t,stats:a}))}).catch(function(){d.current.pop(),m(function(n){return Object.assign({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})}),c&&c(Object.assign({},n,{result:t,stats:a}))})}};d.current.length<f&&l.current.length>0;)n()},[f,c,o,s,a]),{add:r(function(n){l.current.find(function(t){return t.id===n.id})||d.current.find(function(t){return t.id===n.id})||(l.current.push(n),m(function(n){return Object.assign({},n,{numPending:n.numPending+1})}))},[]),stats:a}}
//# sourceMappingURL=use-async-queue.module.js.map
